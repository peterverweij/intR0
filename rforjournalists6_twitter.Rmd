---
title: "Rforjournalists6"
author: "peter verweij"
date: "27-04-2015"
output: html_document
---
#How to work with Twitter in R
Starting by setting the work directory and load twitteR library
```{r}
setwd("C:/Users/hp/Desktop/R/R_for_journalists_handout")
require("twitteR")
```

The second step is getting access to the twitter API to get data from the twitterserver. A bit complicated but here is an [howto](http://thinktostart.com/twitter-authentification-with-r/)
```{r}
library(devtools)
install_github("geoffjentry/twitteR")
library("twitteR")
api_key <- "a4594mS7bOlKlM8A0pHSi2jQc"
api_secret <- "1oQwSFYqdI4f566Ky715mxIXPgky9Oqd4zvAKKVGiWgE5ItAWn"
access_token <- "5505992-69YZsdv2rYpIYDLz5uFLKZ5vqV2JtTcJiEY8kbw6mZ"
access_token_secret <- "jDmKsXethWHkaR5HKJtaM5sGEKzUXLiUOtqmkQBxa3SG1"
setup_twitter_oauth(api_key,api_secret,access_token,access_token_secret)


```
### users and tweets
now we accesst twitter data and can do some data collection
```{r}
# get some tweets about datajournalism
tweets <-searchTwitter("datajournalism", n=50)
head(tweets, 10)
# store tweets into dataframe
df<- twListToDF(tweets)
head(df)
# get information for a user
peter <-getUser("peter_verweij")
peter
peter$getDescription()
peter$getFollowersCount()
peter$getFollowers(n=10)
# tweets by a user
ptweets <-userTimeline("peter_verweij")
ptweets[1:5]
```
### trends
We need to know the  latitude and longitude for the city we want to get trends from. For Amsterdam we get: 52.22  	4.53 
```{r}
trends_adam <-closestTrendLocations(52.22, 4.53)
# find in trends_adam the code for Amsterdam
head(trends_adam)
adam <-getTrends(727232)
head(adam)

```
## Wordcloud
We see from the trends that #Koningsdag is high on the list. When we retrieve the content of a large number of tweets(500) and make a wordcloud out of the tweets we have an impression about what they talk about. We need two new libraries.
```{r}
require("tm")
require("wordcloud")
require("RColorBrewer")
```

We start with downloading the tweets and put them in a corpus

```{r}
kd <-searchTwitter("#Koningsdag", n=500)
kd_text <- sapply(kd, function(x) x$getText())
kd_corpus <- Corpus(VectorSource(kd_text))
kd_corpus <- tm_map(kd_corpus, removePunctuation, mc.cores=1)
pal2 <- brewer.pal(8,"Dark2")
wordcloud(kd_corpus,min.freq=10,max.words=100, random.order=F, colors=pal2)
```

